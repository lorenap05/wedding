<%
  official_gifts = [
    ["Plano oficial para o Lukas não dormir no chão (porque ele já não vai dormir mesmo)", 540],
    ["Fundo não vamos chorar no primeiro mercado", 480],
    ["Nos ajude a pagar nossa dívida estudantil", 340],
    ["Café suficiente para manter o Lukas consciente", 300],
    ["Plano anti-miojo (porque Lorena realmente não sabe cozinhar)", 290],
    ["Kit de energético para sobreviver a 4h de sono por noite", 270],
    ["Primeira compra aleatória que esquecemos que precisávamos", 260],
    ["Reserva para as plantas novas", 250],
    ["Kit pintura para a Lorena ter companhia quando o Lukas estiver trabalhando no sábado", 240],
    ["Kit organização para 40m² de caos controlado", 230],
    ["Reserva para o delivery quando a Lorena queimar comida", 220],
    ["Primeiro pequeno luxo para não surtar", 180],
    ["Poupança para pegar Uber", 170],
    ["Jogo novo de Playstation para o Lukas ter uma vida além do trabalho", 160],
    ["Café da manhã dos campeões", 120],
    ["Chocolate terapêutico para dias difíceis", 100],
    ["Vai na fé que tudo vai dar certo", 70],
    ["Ajude o Lukas a permanecer minimamente funcional", 50]
  ]

  card_items = official_gifts
    .sort_by { |(_, price)| -price }
    .each_with_index
    .map do |(title, price), index|
      {
        name: title,
        price: format("R$ %d", price),
        image_url: "/assets/wedding/gifts/gift_#{index + 1}.png"
      }
    end

  gift_pairs = card_items.each_slice(2).to_a
%>

<section class="giftspage-wrap">
  <div class="giftspage-container">
    <header class="giftspage-header">
      <h1>Lista de presentes</h1>
      <p>Escolha um item simbólico para nos presentear e ajudar com a nossa mudança para São Francisco, especialmente para sobrevivermos às longas horas de trabalho do Lukas e à inabilidade da Lorena na cozinha!</p>
    </header>

    <div class="giftspage-columns">
      <% gift_pairs.each do |pair| %>
        <% pair.each do |item| %>
          <article class="giftspage-card">
            <img src="<%= item[:image_url] %>" alt="<%= item[:name] %>" class="giftspage-photo">
            <h2><%= item[:name] %></h2>
            <p class="giftspage-desc"><%= item[:description] %></p>
            <p class="giftspage-price"><%= item[:price] %></p>
            <button type="button" class="btn btn-light giftspage-buy js-open-payment" data-gift-name="<%= item[:name] %>" data-gift-price="<%= item[:price] %>">Comprar</button>
          </article>
        <% end %>
      <% end %>
    </div>
  </div>
</section>

<div class="gift-modal" id="payment-modal" aria-hidden="true">
  <div class="gift-modal-backdrop js-close-payment"></div>
  <div class="gift-modal-card" role="dialog" aria-modal="true" aria-labelledby="payment-modal-title">
    <button type="button" class="gift-modal-close js-close-payment" aria-label="Fechar">×</button>
    <h2 id="payment-modal-title">Pagamento via Pix</h2>
    <p class="gift-modal-item" id="payment-gift-name">Item</p>
    <p class="gift-modal-item" id="payment-gift-price">Valor</p>
    <p class="gift-modal-text">Escaneie o QR Code abaixo ou use a chave pix 091.882.056-14 para realizar o pagamento</p>


    <div class="gift-modal-qr-wrap">
      <img src="/assets/wedding/qr_code.jpg" alt="QR Code para pagamento" class="gift-modal-qr" loading="lazy">
    </div>

    <button type="button" class="gift-modal-confirm js-open-thanks">Pagamento efetuado</button>
  </div>
</div>

<div class="gift-modal" id="thanks-modal" aria-hidden="true">
  <div class="gift-modal-backdrop js-close-thanks"></div>
  <div class="gift-modal-card" role="dialog" aria-modal="true" aria-labelledby="thanks-modal-title">
    <button type="button" class="gift-modal-close js-close-thanks" aria-label="Fechar">×</button>
    <h2 id="thanks-modal-title">Obrigado(a)!</h2>
    <p class="gift-modal-text">Recebemos sua confirmação de pagamento.</p> 
    <p class="gift-modal-text">Te esperamos no dia 13/06!</p>
    <img src="/assets/wedding/thank_you.jpg" alt="Obrigado" class="gift-modal-thank-image" loading="lazy">
  </div>
</div>

<script>
  (function() {
    const paymentModal = document.getElementById('payment-modal');
    const thanksModal = document.getElementById('thanks-modal');
    const paymentName = document.getElementById('payment-gift-name');
    const paymentPrice = document.getElementById('payment-gift-price');

    if (!paymentModal || !thanksModal) return;

    const openPaymentButtons = document.querySelectorAll('.js-open-payment');
    const closePaymentButtons = document.querySelectorAll('.js-close-payment');
    const closeThanksButtons = document.querySelectorAll('.js-close-thanks');
    const openThanksButton = document.querySelector('.js-open-thanks');

    function openModal(modal) {
      modal.classList.add('active');
      modal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeModal(modal) {
      modal.classList.remove('active');
      modal.setAttribute('aria-hidden', 'true');
      if (!paymentModal.classList.contains('active') && !thanksModal.classList.contains('active')) {
        document.body.style.overflow = '';
      }
    }

    openPaymentButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        paymentName.textContent = button.dataset.giftName || 'Item selecionado';
        paymentPrice.textContent = button.dataset.giftPrice || '';
        openModal(paymentModal);
      });
    });

    closePaymentButtons.forEach(function(button) {
      button.addEventListener('click', function() { closeModal(paymentModal); });
    });

    if (openThanksButton) {
      openThanksButton.addEventListener('click', function() {
        closeModal(paymentModal);
        openModal(thanksModal);
      });
    }

    closeThanksButtons.forEach(function(button) {
      button.addEventListener('click', function() { closeModal(thanksModal); });
    });
  })();
</script>
